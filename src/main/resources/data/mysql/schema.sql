DROP TABLE IF EXISTS MEDIA;
DROP TABLE IF EXISTS MEDIA_TYPE;
DROP TABLE IF EXISTS ARTICLE;
DROP TABLE IF EXISTS ROLE;
DROP TABLE IF EXISTS USER;
DROP TABLE IF EXISTS USER_ROLE;


CREATE TABLE ROLE (
  ID   INTEGER      NOT NULL AUTO_INCREMENT PRIMARY KEY,
  NAME VARCHAR(255) NOT NULL
);

CREATE TABLE USER (
  id       INTEGER      NOT NULL AUTO_INCREMENT,
  login    VARCHAR(255) NOT NULL UNIQUE,
  name     VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  PRIMARY KEY (id)
);

CREATE TABLE USER_ROLE (
  user_id INTEGER NOT NULL,
  role_id INTEGER NOT NULL
);

ALTER TABLE user_role ADD CONSTRAINT FK_it77eq964jhfqtu54081ebtio FOREIGN KEY (role_id) REFERENCES Role (id);

ALTER TABLE user_role ADD CONSTRAINT FK_apcc8lxk2xnug8377fatvbn04 FOREIGN KEY (user_id) REFERENCES User (id);

CREATE TABLE MEDIA_TYPE (
  MEDIA_TYPE_ID   BIGINT       NOT NULL AUTO_INCREMENT,
  MEDIA_TYPE_NAME VARCHAR(255) NOT NULL,
  PRIMARY KEY (MEDIA_TYPE_ID)
);

ALTER TABLE MEDIA_TYPE ADD CONSTRAINT UK_6p8cm73jy7qvg74kup52qv9rh UNIQUE (MEDIA_TYPE_NAME);


CREATE TABLE MEDIA (
  MEDIA_ID      BIGINT AUTO_INCREMENT NOT NULL,
  MEDIA_BLOB    LONGBLOB              NOT NULL,
  MEDIA_TYPE_ID BIGINT REFERENCES MEDIA_TYPE (MEDIA_TYPE_ID),
  PRIMARY KEY (MEDIA_ID)
);


CREATE TABLE ARTICLE (
  ARTICLE_ID        BIGINT AUTO_INCREMENT NOT NULL,
  ARTICLE_NAME      VARCHAR(50)           NOT NULL,
  ARTICLE_CONTENT   LONGTEXT              NOT NULL,
  ARTICLE_CREATED   DATETIME              NOT NULL,
  ARTICLE_PUBLISHED INT                   NOT NULL,
  USER_ID INTEGER REFERENCES USER(USER_ID),
  PRIMARY KEY (ARTICLE_ID)
);
